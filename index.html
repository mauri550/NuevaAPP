<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>APP</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="css/themes/default/jquery.mobile-1.3.0.css" />
	<link rel="stylesheet"  href="css/sportafterwork.css" />

	<script src="js/jquery.js"></script>
	<script src="js/jquery.mobile-1.3.0.js" type="text/javascript"></script>

	<script src="js/jquery.validate.min.js" type="text/javascript"></script>
	<script src="js/messages_fr.js" type="text/javascript"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>

	<script>
		
		$(document).ready(function() {
			$("#reporte").validate();
		});
		
	</script>
    <script>

    /*------------Autenticacion---------------*/
    if (localStorage['autenticado']=="true"){
        
        window.location="formulario.html";
        return false;
    }




    $(document).ready(function () {
           //event handler for submit button
           $("#btnSubmit").click(function () {
               //collect userName and password entered by users
               var userNameForm = $("#username").val();
               var passwordForm = $("#password").val();
              
               

               $.getJSON('datos.json', function(data) {

                var key, count = 0;
                for(key in data.users) {
                  if(data.users.hasOwnProperty(key)) {
                    count++;
                  }
                }
                var i = 0;
                var error = false;
                while (i < count ) {

                    if (data.users[i].userName==userNameForm && data.users[i].password==passwordForm) {
                       
                       var session="autenticado";
                       var estado="true";
                       var iduser=i;
                       localStorage.setItem(session, estado);
                       localStorage.setItem("nombre", data.users[iduser].Nombre+' '+data.users[iduser].Apellido);
                       localStorage.setItem("codigo", data.users[iduser].Codigo);
                       localStorage.setItem("contacto", data.users[iduser].Contacto);
                       

                       $("#username").val("");
                       $("#password").val("");
                       window.location="formulario.html";


                        break 
                    }
                    else{
                                               
                        if(i==count-1){
                            alert("Datos no validos!. Favor Verificar");
                            break 
                        }
                        else{
                            i++
                        }
                           
                           

                       /*navigator.notification.beep(1)*/
                        
                    };
                       

                    
                }

                

                 
               });
           });


       });
            function cerrar_seccion()
            {
                localStorage.removeItem('autenticado'); 
                localStorage.removeItem('nombre'); 
                localStorage.removeItem('codigo'); 
                localStorage.removeItem('contacto'); 
            }
       
      </script>

</head>

<body>
        <section id="page-login" data-role="page" data-theme="d">    
        <header data-role="header">
            <h1>INICIAR SESSION</h1>
        </header>
        <article data-role="content">
           
            <input type="text" name="username" id="username" class="text" maxlength="30" />
            <br />
            <input type="password" name="password" id="password" class="text" maxlength="30" />
            <br />
            <input type="submit" name="btnSubmit" id="btnSubmit" value="Iniciar Session"/>
            

        </article>  

    </section>

		


</body>
</html>
